### 梅花易数 Web App 开发计划

#### 1. 项目概述
本项目旨在创建一个基于梅花易数的 Web App，用户可以通过不同的起卦方法（时间起卦、三数起卦、自选起卦）生成卦象，并展示主卦、互卦、变卦、错卦和综卦。后期可扩展为安卓 APP。

#### 2. 功能模块
- **侧边导航栏**：包含“首页”和“设置”两个选项。
- **顶部标签栏**：用于切换不同的起卦方法，包括“时间起卦”、“三数起卦”、“自选起卦”。
- **主内容区域**：根据选中的标签显示不同的输入表单和起卦结果。
- **起卦结果展示**：显示主卦、互卦、变卦、错卦和综卦。

#### 3. 起卦方法及逻辑
##### 3.1 时间起卦
#### 计算步骤：
1. 获取当前时间：
   - 年：子年=1，丑年=2，...，亥年=12
   - 月：正月=1，二月=2，...，十二月(腊月）=12
   - 日：初一=1，初二=2，...，三十日=30
   - 时：子时=1，丑时=2，...，亥时=12

2. 计算：
   - 上卦数 = (年 + 月 + 日) % 8
   - 下卦数 = (年 + 月 + 日 + 时) % 8
   - 动爻数 = (年 + 月 + 日 + 时) % 6

3. 对应逻辑：
   - 如果结果为0，则取8（坤卦）或6（动爻）

#### 示例：
假设现在是2023年（卯年=4），5月，15日，上午10点（巳时=6）
- 上卦 = (4 + 5 + 15) % 8 = 24 % 8 = 0 → 8（坤卦）
- 下卦 = (4 + 5 + 15 + 6) % 8 = 30 % 8 = 6 → 6（坎卦）
- 动爻 = 30 % 6 = 0 → 6（上爻）

4. 根据数字对应卦象生成主卦。

5. 根据主卦推演出互卦、变卦、错卦和综卦。




##### 3.2 三数起卦

#### 计算步骤：
1. 用户输入三个数字（num1, num2, num3）
2. 计算：
   - 上卦数 = num1 % 8
   - 下卦数 = num2 % 8
   - 动爻数 = (num1 + num2 + num3) % 6

3. 对应逻辑：
   - 如果结果为0，则取8（坤卦）或6（动爻）

#### 示例：
用户输入：7，15，22
- 上卦 = 7 % 8 = 7 → 7（艮卦）
- 下卦 = 15 % 8 = 7 → 7（艮卦）
- 动爻 = (7 + 15 + 22) % 6 = 44 % 6 = 2 → 2（二爻）

4. 根据数字对应卦象生成主卦。

5. 根据主卦推演出互卦、变卦、错卦和综卦。



##### 3.3 自选起卦

#### 计算步骤：
1. 用户输入六个数字（0或1），例如：[1, 0, 1, 1, 0, 1]
   - 0表示阴爻（--）
   - 1表示阳爻（—）
   - 从下往上排列

2. 转换为卦象：
   - 下卦 = 下面三个爻
   - 上卦 = 上面三个爻

3. 动爻由用户指定

#### 示例：
用户输入：[1, 0, 1, 1, 0, 1]，动爻=3
- 下卦：1, 0, 1 → 离卦（☲）
- 上卦：1, 0, 1 → 离卦（☲）
- 动爻：3（三爻）

4. 根据选择的卦象生成主卦。

5. 根据主卦推演出互卦、变卦、错卦和综卦。




#### 4. 梅花易数推演原则
- **主卦（本卦）**：是起卦时最初得到的卦象，由下往上数六爻组成。
- **互卦（内卦）**：从主卦中抽取第2、3、4爻组成下卦，从主卦中抽取第3、4、5爻组成上卦。
- **变卦**：根据动爻的变化而来，将主卦中的动爻阳变阴、阴变阳，其余爻保持不变。
- **综卦**：把本卦旋转180度，就是综卦。注意，是旋转了，如同倒立，头朝上变成了头朝下。不是上卦和下卦交换位置。
- **错卦**：将主卦每一爻阴阳颠倒而得，主卦中的阳爻全部变为阴爻，主卦中的阴爻全部变为阳爻。

#### 5. 64卦信息
- **卦名**：如乾、坤、屯、蒙等。
- **卦象**：如乾为天、坤为地等。
- **卦辞**：每卦的简要解释。
- **爻辞**：每爻的详细解释。

#### 6. 分步骤完善各版块
##### 6.1 首页
- 显示欢迎信息和简要介绍。
- 提供导航到不同起卦方法的链接。

##### 6.2 时间起卦
- 显示当前时间。
- 提供时间起卦按钮。
- 显示起卦结果（主卦、互卦、变卦、错卦、综卦）。

##### 6.3 三数起卦
- 提供三个输入框供用户输入数字。
- 提供三数起卦按钮。
- 显示起卦结果（主卦、互卦、变卦、错卦、综卦）。

##### 6.4 自选起卦
- 提供卦象选择界面。
- 提供自选起卦按钮。
- 显示起卦结果（主卦、互卦、变卦、错卦、综卦）。

#### 7. 适配 CURSOR 风格的提示词
- **侧边导航栏**：`<SideNav>`
- **顶部标签栏**：`<TopTabs>`
- **主内容区域**：`<MainContent>`
- **起卦结果展示**：`<ResultDisplay>`
- **时间起卦**：`<TimeDivination>`
- **三数起卦**：`<ThreeNumberDivination>`
- **自选起卦**：`<CustomDivination>`

#### 8. 代码示例
```html
<SideNav>
  <NavItem to="/">首页</NavItem>
  <NavItem to="/settings">设置</NavItem>
</SideNav>

<TopTabs>
  <Tab label="时间起卦" to="/time-divination" />
  <Tab label="三数起卦" to="/three-number-divination" />
  <Tab label="自选起卦" to="/custom-divination" />
</TopTabs>

<MainContent>
  <Route path="/time-divination" component={TimeDivination} />
  <Route path="/three-number-divination" component={ThreeNumberDivination} />
  <Route path="/custom-divination" component={CustomDivination} />
</MainContent>

<ResultDisplay>
  <div>主卦: {mainGua}</div>
  <div>互卦: {huGua}</div>
  <div>变卦: {bianGua}</div>
  <div>错卦: {cuoGua}</div>
  <div>综卦: {zongGua}</div>
</ResultDisplay>
```

#### 9. 后续扩展
- 将 Web App 打包为安卓 APP。
- 增加用户登录和保存历史记录功能。
- 提供更多起卦方法和详细解释。

通过以上步骤和逻辑，您可以逐步完善梅花易数 Web App 的各个功能模块，并确保代码结构清晰、逻辑正确。



为了高效、流畅地开发梅花易数 Web App，并确保其具有良好的扩展性和后期可移植性（如扩展到安卓 APP），以下是推荐的技术栈和架构选择：

---

### 1. **前端开发**
#### 语言与框架
- **推荐语言**：JavaScript / TypeScript
- **推荐框架**：React.js 或 Vue.js
  - **React.js**：组件化开发，生态丰富，适合复杂应用。
  - **Vue.js**：轻量易上手，适合中小型项目。
- **UI 组件库**：
  - **Ant Design**（React）或 **Element UI**（Vue）：提供丰富的 UI 组件，快速构建界面。
  - **Tailwind CSS**：灵活的 CSS 框架，适合自定义设计。

#### 状态管理
- **React**：使用 Redux 或 Zustand 管理全局状态（如卦象数据、用户设置）。
- **Vue**：使用 Vuex 或 Pinia 管理全局状态。

#### 路由管理
- **React**：使用 React Router。
- **Vue**：使用 Vue Router。

#### 响应式设计
- 使用 CSS 媒体查询或框架（如 Bootstrap、Tailwind CSS）确保 Web App 在移动端和桌面端都能良好显示。

---

### 2. **后端开发**
#### 语言与框架
- **推荐语言**：Node.js（JavaScript/TypeScript）
- **推荐框架**：Express.js 或 NestJS
  - **Express.js**：轻量灵活，适合快速开发。
  - **NestJS**：基于 TypeScript，支持模块化开发，适合中大型项目。

#### 数据库
- **推荐数据库**：MongoDB 或 PostgreSQL
  - **MongoDB**：适合存储非结构化数据（如卦象数据、用户记录）。
  - **PostgreSQL**：适合需要强一致性和复杂查询的场景。

#### API 设计
- 使用 RESTful API 或 GraphQL：
  - **RESTful API**：简单易用，适合大多数场景。
  - **GraphQL**：灵活高效，适合复杂数据查询。

#### 身份验证
- 使用 JWT（JSON Web Token）实现用户登录和权限管理。

---

### 3. **移动端扩展（后期）**
#### 跨平台开发
- **推荐框架**：React Native 或 Flutter
  - **React Native**：基于 React，适合已有 React Web 开发经验的团队。
  - **Flutter**：性能优异，适合需要高度定制 UI 的场景。

#### 与 Web App 共享代码
- 使用 **React Native for Web** 或 **Flutter Web**，可以将 Web App 的部分代码复用到移动端。

---

### 4. **架构设计**
#### 前端架构
- **组件化开发**：将页面拆分为可复用的组件（如导航栏、卦象展示区）。
- **分层架构**：
  - **UI 层**：负责展示和用户交互。
  - **逻辑层**：处理卦象计算、数据转换等业务逻辑。
  - **数据层**：管理全局状态和 API 请求。

#### 后端架构
- **MVC 架构**：
  - **Model**：定义数据模型（如卦象、用户）。
  - **View**：提供 API 接口。
  - **Controller**：处理业务逻辑（如起卦计算、数据存储）。
- **微服务架构**（可选）：如果后期功能扩展复杂，可以将不同功能模块拆分为独立服务。

---

### 5. **开发工具**
#### 版本控制
- 使用 Git 进行版本控制，托管在 GitHub 或 GitLab。

#### 包管理
- **Node.js**：使用 npm 或 yarn 管理依赖。
- **Flutter**：使用 pub 管理依赖。

#### 构建工具
- **Webpack** 或 **Vite**：用于打包和优化前端代码。
- **Babel**：用于兼容不同浏览器。

#### 测试工具
- **单元测试**：Jest（React/Vue）或 Mocha（Node.js）。
- **端到端测试**：Cypress 或 Playwright。

---

### 6. **部署与运维**
#### 前端部署
- 使用 **Vercel** 或 **Netlify** 快速部署静态网站。
- 使用 **CDN**（如 Cloudflare）加速资源加载。

#### 后端部署
- 使用 **Docker** 容器化部署，确保环境一致性。
- 使用 **Kubernetes** 管理容器化应用（适合中大型项目）。
- 部署平台：AWS、Google Cloud、Azure 或阿里云。

#### 监控与日志
- 使用 **Sentry** 监控前端错误。
- 使用 **Prometheus + Grafana** 监控后端性能。
- 使用 **ELK Stack**（Elasticsearch, Logstash, Kibana）管理日志。

---

### 7. **扩展性设计**
#### 模块化开发
- 将起卦方法、卦象展示等功能拆分为独立模块，便于后期扩展。

#### 插件化设计
- 支持自定义起卦方法或卦象展示方式，通过插件机制实现。

#### 多语言支持
- 使用 **i18n** 实现多语言支持，便于后期国际化。

---

### 8. **技术栈总结**
| 模块         | 技术栈                                                                 |
|--------------|------------------------------------------------------------------------|
| 前端         | React.js / Vue.js + TypeScript + Ant Design / Tailwind CSS             |
| 后端         | Node.js + Express.js / NestJS + MongoDB / PostgreSQL                  |
| 移动端       | React Native / Flutter                                                |
| 数据库       | MongoDB / PostgreSQL                                                 |
| 部署         | Docker + Kubernetes + Vercel / Netlify                                |
| 监控与日志   | Sentry + Prometheus + Grafana + ELK Stack                             |

---

### 9. **示例技术栈组合**
#### 组合 1：React + Node.js + MongoDB
- **前端**：React.js + Ant Design + Redux
- **后端**：Node.js + Express.js + MongoDB
- **移动端**：React Native
- **部署**：Docker + Kubernetes + Vercel

#### 组合 2：Vue + NestJS + PostgreSQL
- **前端**：Vue.js + Element UI + Vuex
- **后端**：NestJS + PostgreSQL
- **移动端**：Flutter
- **部署**：Docker + Kubernetes + Netlify

---

通过以上技术栈和架构设计，可以高效开发梅花易数 Web App，并确保其具有良好的扩展性和后期可移植性。